import{c as me}from"./IconPlus-9E_WsN9m.js";import{d as fe,u as ge,B as be,c as Q,r as p,w as Z,o as he,a as n,b as a,t as g,j as y,e as r,v as x,F as I,f as U,x as ee,g as E,y as le,l as Y,h as o}from"./index-ncxBXQcV.js";import{_ as F}from"./lodash-8s0yUWKW.js";import{s as u}from"./request-S_I54wxY.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";/**
 * @license @tabler/icons-vue v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Dl=me("outline","search","IconSearch",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]);const ke=()=>u.get("/cbtumblebug/ns"),Ce=t=>u.get(`/cbtumblebug/ns/${t}/mci`),Ie=t=>u.get(`/cbtumblebug/ns/${t.nsId}/mci/${t.mciId}`),we=t=>u.get(`/cbtumblebug/ns/${t}/k8scluster`),Se=t=>u.get(`/catalog/software?name=${t}`),Fl=t=>u.get(`/catalog/software/${t}`),Kl=t=>u.get(`/search/dockerhub/${t}`),zl=t=>u.get(`/search/artifacthub/${t}`),xe=t=>u.post("/applications/vm/deploy",t),ae=t=>u.post("/applications/action",t),Ve=t=>u.post("/applications/k8s/deploy",t),Ue=t=>u.get(`/applications/vm/check?namespace=${t.namespace}&mciId=${t.mciName}&vmId=${t.vmName}&catalogId=${t.catalogId}`),Me=t=>u.get(`/applications/k8s/check?namespace=${t.namespace}&clusterName=${t.clusterName}&catalogId=${t.catalogId}`),Bl=t=>u.get(`/ape/log/${t}`);function jl(t){return u.post("/catalog/software",t)}function ql(t){return u.put(`/catalog/software/${t.id}`,t)}function Yl(t){return u.delete(`/catalog/software/${t}`)}function Ol(){return u.get("/api/applications/status/groups")}function Wl(t){return u.post("/catalog/application/category",t)}function Xl(t){return u.post("/catalog/application/package",t)}function Gl(t){const w={target:t.target,applicationName:t.packageName};return u.post("/catalog/application/package/version",w)}function Jl(t){return u.get(`/search/dockerhub/tag/${t.path}`)}function Ql(t){return u.get(`/search/artifacthub/version/${t.kind}/${t.repository}/${t.packageName}`)}function Zl(t){return u.post("/catalog/docker/register",t)}function ea(t){return u.post("/catalog/helm/register",t)}function la(t){return u.post("/catalog/rating/overall",t)}function aa(t){return u.get(`/api/applications/integrated/deployment/${t}`)}function ta(t){return u.get(`/catalog/selectbox/options?type=${t}`)}const Ae={class:"modal fade",id:"install-form",tabindex:"-1"},Ne={class:"modal-dialog modal-lg",role:"document"},Ee={class:"modal-content"},_e={class:"modal-header"},Le={class:"modal-title"},$e={class:"modal-body",style:{"max-height":"calc(100vh - 200px)","overflow-y":"auto"}},Pe={class:"mb-3"},Re={key:0,class:"text-muted"},Te={key:1,class:"text-muted"},He=["value"],De={class:"mb-3"},Fe={key:0,class:"text-muted"},Ke={key:1,class:"text-muted"},ze=["value"],Be={value:"selectNsId"},je={class:"mb-3"},qe={key:0,class:"text-muted"},Ye={key:1,class:"text-muted"},Oe=["disabled"],We=["value"],Xe={class:"mb-3"},Ge=["disabled"],Je=["value"],Qe={key:0,class:"mt-2",style:{display:"flex",gap:"10px","flex-wrap":"wrap"}},Ze=["onClick"],el={class:"mb-3"},ll={style:{display:"flex",gap:"10px"}},al={class:"form-check"},tl={class:"form-check"},sl={class:"mb-3"},nl=["value"],ol={class:"mb-3"},il={class:"mb-3"},ul={key:0,class:"text-muted"},rl={key:1,class:"text-muted"},cl=["value"],dl={value:"selectNsId"},pl={class:"mb-3"},vl={key:0,class:"text-muted"},ml={key:1,class:"text-muted"},fl=["disabled"],gl=["value"],bl={class:"mb-3"},hl=["value"],yl={key:0,class:"mb-3"},kl={class:"mb-2"},Cl={class:"form-check"},Il={key:0,class:"d-flex justify-content-between"},wl={key:1,class:"mb-3"},Sl={class:"mb-2"},xl={class:"form-check"},Vl={key:0},Ul={class:"mb-2"},Ml={class:"mb-2"},Al={class:"mb-2"},Nl={class:"modal-footer d-flex justify-content-between"},El=["disabled"],_l=["disabled"],Ll=fe({__name:"applicationInstallationForm",props:{nsId:{},title:{}},setup(t){const w=ge(),O=be(),K=t,c=Q(()=>K.title),W=p([]),V=p([]),T=p([]),M=p([]),_=p([]),R=p([]),d=p(""),i=p(""),k=p(""),C=p(""),v=p([]),b=p("Standalone"),m=p({}),f=p({}),H=p([]),A=p(""),S=p(""),D=p(""),N=p(!0);Z(d,async s=>{F.isEmpty(i.value)||(s==="VM"?(k.value="",C.value="",v.value=[],M.value=[],_.value=[],await B()):s==="K8S"&&(A.value="",await j()),S.value="",$())}),Z(b,()=>{b.value==="Standalone"?(v.value=[],M.value=[..._.value]):b.value==="Clustering"&&(v.value=[],M.value=[..._.value])}),he(async()=>{document.getElementById("install-form").addEventListener("show.bs.modal",async()=>{await z(),await te()})});const z=async()=>{d.value="VM",i.value="",k.value="",C.value="",v.value=[],_.value=[],b.value="Standalone",m.value={hpaEnabled:!1,hpaMinReplicas:1,hpaMaxReplicas:10,hpaCpuUtilization:60,hpaMemoryUtilization:80},f.value={ingressEnabled:!1,ingressHost:"",ingressPath:"/",ingressClass:"nginx",ingressTlsEnabled:!1,ingressTlsSecret:""},se(),ne(),await oe()},te=async()=>{await Se("").then(({data:s})=>{R.value=s})},se=()=>{W.value=[{key:"VM",value:"VM"},{key:"k8s",value:"K8S"}]},ne=()=>{c.value==="Application Uninstallation"?N.value=!1:N.value=!0},oe=async()=>{await ke().then(async({data:s})=>{if(console.log("## data ### : ",s),V.value=s,V.value.length>0)if(!F.isEmpty(K.nsId))i.value=K.nsId;else if(F.isEmpty(O.getNsId()))i.value=V.value[0].name;else{const e=O.getNsId();V.value.find(h=>h.name===e)?i.value=e:i.value=V.value[0].name}F.isEmpty(i.value)||(d.value==="VM"?await B():d.value==="K8S"&&await j())})},B=async()=>{await Ce(i.value).then(async({data:s})=>{T.value=s,T.value.length>0?(k.value=T.value[0].name,await X()):k.value=""})},X=async()=>{const s={nsId:i.value,mciId:k.value};await Ie(s).then(({data:e})=>{_.value=e.vm,M.value=_.value.filter(l=>!v.value.includes(l.id)),C.value=""})},j=async()=>{await we(i.value).then(({data:s})=>{H.value=s,H.value.length>0?A.value=H.value[0].name:A.value=""})},q=async()=>{v.value=[],await B(),$()},ie=async()=>{v.value=[],await X(),$()},ue=async()=>{await j(),$()},$=()=>{c.value==="Application Installation"?N.value=!0:c.value==="Application Uninstallation"&&(N.value=!1)},re=()=>{if(C.value!==""){if(b.value==="Standalone")v.value=[C.value];else if(b.value==="Clustering"&&!v.value.includes(C.value)){v.value.push(C.value);const s=M.value.findIndex(e=>e.id===C.value);s!==-1&&M.value.splice(s,1)}C.value="",$()}},ce=s=>{const e=v.value[s];if(v.value.splice(s,1),b.value==="Clustering"){const l=_.value.find(h=>h.id===e);l&&M.value.push(l)}$()},de=async()=>{let s={};if(d.value==="VM"){S.value.split(",").map(l=>l.toLowerCase().trim());let e={};if(c.value=="Application Installation"){const l=b.value==="Clustering"?`${S.value}-cluster`:`${S.value}-standalone`;e={namespace:i.value,mciId:k.value,vmIds:v.value,clusterName:l,catalogId:L.value,servicePort:D.value,username:"admin",deploymentType:d.value,vmDeploymentMode:b.value.toUpperCase()},s=await xe(e)}else s=await ae(e);s.data?w.success("SUCCESS"):w.error("FAIL")}else if(d.value==="K8S"){S.value.split(",").map(l=>l.toLowerCase().trim());let e={namespace:i.value,clusterName:A.value,catalogId:L.value,servicePort:D.value,username:"",deploymentType:d.value,hpaEnabled:m.value.hpaEnabled,minReplicas:m.value.hpaMinReplicas,maxReplicas:m.value.hpaMaxReplicas,cpuThreshold:m.value.hpaCpuUtilization,memoryThreshold:m.value.hpaMemoryUtilization,ingressEnabled:f.value.ingressEnabled,ingressHost:f.value.ingressHost,ingressPath:f.value.ingressPath,ingressClass:f.value.ingressClass,ingressTlsEnabled:f.value.ingressTlsEnabled,ingressTlsSecret:f.value.ingressTlsSecret};c.value=="Application Installation"?s=await Ve(e):s=await ae(e),s.data?w.success("SUCCESS"):w.error("FAIL")}},pe=async()=>{d.value==="VM"||d.value==="K8S"?ve().then(s=>{let e=!0;if(s===null){w.error("Please select all items");return}else if(s===!1){let l="";d.value==="VM"?l="VM":d.value==="K8S"&&(l="CLUSTER");const h="Your selected "+l+" has lower specifications than recommended. Would you like to continue with the installation?";e=confirm(h)}e&&(w.success("Please click RUN"),N.value=!1)}):w.error("Please Select Infra")},ve=async()=>{let s=!1;if(d.value==="VM"){if(i.value===""||k.value===""||v.value.length===0||L.value===0)return null;{const e={namespace:i.value,mciName:k.value,vmName:v.value[0],catalogId:L.value};await Ue(e).then(({data:l})=>{s=l})}}else if(d.value==="K8S"){if(i.value===""||A.value===""||L.value===0){w.error("Please select all items");return}const e={namespace:i.value,clusterName:A.value,catalogId:L.value};await Me(e).then(({data:l})=>{s=l})}return s},L=p(0),G=Q(()=>d.value==="VM"?R.value.filter(s=>s.packageInfo):d.value==="K8S"?R.value.filter(s=>s.helmChart):R.value),J=()=>{c.value==="Application Installation"&&(N.value=!0),R.value.forEach(s=>{if(S.value===s.name){L.value=s.id;return}})};return(s,e)=>(o(),n("div",Ae,[a("div",Ne,[a("div",Ee,[a("div",_e,[a("h5",Le,g(c.value),1),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:z})]),a("div",$e,[a("div",Pe,[e[22]||(e[22]=a("label",{class:"form-label"},"Target Infra",-1)),c.value=="Application Installation"?(o(),n("p",Re," Select the Infra what is the Infra will be installed ")):c.value=="Application Uninstallation"?(o(),n("p",Te," Select the Infra what is the Infra will be uninstalled ")):y("",!0),r(a("select",{class:"form-select",id:"infra","onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l)},[(o(!0),n(I,null,U(W.value,l=>(o(),n("option",{value:l.value,key:l.value},g(l.value),9,He))),128))],512),[[x,d.value]])]),d.value=="VM"?(o(),n(I,{key:0},[a("div",De,[e[23]||(e[23]=a("label",{class:"form-label"},"Namespace",-1)),c.value=="Application Installation"?(o(),n("p",Fe," Select the namespace where the application will be installed")):c.value=="Application Uninstallation"?(o(),n("p",Ke," Select the namespace where the application will be uninstalled")):y("",!0),V.value.length>0?r((o(),n("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[1]||(e[1]=l=>i.value=l),onChange:q},[(o(!0),n(I,null,U(V.value,l=>(o(),n("option",{value:l.name,key:l.name},g(l.name),9,ze))),128))],544)),[[x,i.value]]):r((o(),n("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[2]||(e[2]=l=>i.value=l),onChange:q},[a("option",Be,g(i.value),1)],544)),[[x,i.value]])]),a("div",je,[e[24]||(e[24]=a("label",{class:"form-label"},"MCI Name",-1)),c.value=="Application Installation"?(o(),n("p",qe," Select the multi-cloud infrastructure information where the application will be deployed")):c.value=="Application Uninstallation"?(o(),n("p",Ye," Remove the application and associated resources from the multi-cloud infrastructure")):y("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[3]||(e[3]=l=>k.value=l),onChange:ie},[(o(!0),n(I,null,U(T.value,l=>(o(),n("option",{value:l.id,key:l.name},g(l.name),9,We))),128))],40,Oe),[[x,k.value]])]),a("div",Xe,[e[26]||(e[26]=a("label",{class:"form-label"},"VM Name",-1)),e[27]||(e[27]=a("p",{class:"text-muted"}," Select the virtual machine (VM) within the chosen multi-cloud infrastructure where the application will be deployed",-1)),r(a("select",{class:"form-select",id:"mci-name",disabled:k.value=="","onUpdate:modelValue":e[4]||(e[4]=l=>C.value=l),onChange:re},[e[25]||(e[25]=a("option",{value:""},"Select VM",-1)),(o(!0),n(I,null,U(M.value,l=>(o(),n("option",{value:l.id,key:l.name},g(l.name),9,Je))),128))],40,Ge),[[x,C.value]]),v.value.length>0?(o(),n("div",Qe,[(o(!0),n(I,null,U(v.value,(l,h)=>(o(),n("label",{key:h,class:"form-check-label",style:{border:"1px solid #000",padding:"5px","border-radius":"5px",cursor:"pointer"}},[Y(g(l)+" ",1),a("span",{onClick:P=>ce(h),style:{"margin-left":"5px","font-weight":"bold"}},"X",8,Ze)]))),128))])):y("",!0)]),a("div",el,[e[30]||(e[30]=a("label",{class:"form-label"},"Deployment Type",-1)),e[31]||(e[31]=a("p",{class:"text-muted"},"Select the deployment type",-1)),a("div",ll,[a("div",al,[r(a("input",{class:"form-check-input",type:"radio",id:"Standalone","onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),value:"Standalone"},null,512),[[ee,b.value]]),e[28]||(e[28]=a("label",{class:"form-check-label",for:"Standalone"},"Standalone",-1))]),a("div",tl,[r(a("input",{class:"form-check-input",type:"radio",id:"Clustering","onUpdate:modelValue":e[6]||(e[6]=l=>b.value=l),value:"Clustering"},null,512),[[ee,b.value]]),e[29]||(e[29]=a("label",{class:"form-check-label",for:"Clustering"},"Clustering",-1))])])]),a("div",sl,[e[32]||(e[32]=a("label",{class:"form-label"},"Application",-1)),e[33]||(e[33]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[7]||(e[7]=l=>S.value=l),onChange:J},[(o(!0),n(I,null,U(G.value,(l,h)=>{var P;return o(),n("option",{key:h,value:l.name}," ["+g(l.name)+"] "+g(((P=l.packageInfo)==null?void 0:P.packageVersion)||"latest"),9,nl)}),128))],544),[[x,S.value]])]),a("div",ol,[e[34]||(e[34]=a("label",{class:"form-label"},"Port",-1)),e[35]||(e[35]=a("p",{class:"text-muted"},"Please enter a port accessible from the outside",-1)),r(a("input",{type:"number",class:"form-control",placeholder:"8080","onUpdate:modelValue":e[8]||(e[8]=l=>D.value=l)},null,512),[[E,D.value]])])],64)):d.value=="K8S"?(o(),n(I,{key:1},[a("div",il,[e[36]||(e[36]=a("label",{class:"form-label"},"Namespace",-1)),c.value=="Application Installation"?(o(),n("p",ul,"Select the namespace where the application will be installed")):c.value=="Application Uninstallation"?(o(),n("p",rl,"Select the namespace where the application will be uninstalled")):y("",!0),V.value.length>0?r((o(),n("select",{key:2,class:"form-select",id:"namesapce","onUpdate:modelValue":e[9]||(e[9]=l=>i.value=l),onChange:ue},[(o(!0),n(I,null,U(V.value,l=>(o(),n("option",{value:l.name,key:l.name},g(l.name),9,cl))),128))],544)),[[x,i.value]]):r((o(),n("select",{key:3,class:"form-select",id:"namesapce","onUpdate:modelValue":e[10]||(e[10]=l=>i.value=l),onChange:q},[a("option",dl,g(i.value),1)],544)),[[x,i.value]])]),a("div",pl,[e[37]||(e[37]=a("label",{class:"form-label"},"ClusterName",-1)),c.value=="Application Installation"?(o(),n("p",vl,"Select the name of the cluster where the application will be deployed")):c.value=="Application Uninstallation"?(o(),n("p",ml,"Remove the application and associated resources from the multi-cloud infrastructure")):y("",!0),r(a("select",{class:"form-select",id:"mci-name",disabled:i.value=="","onUpdate:modelValue":e[11]||(e[11]=l=>A.value=l)},[(o(!0),n(I,null,U(H.value,l=>(o(),n("option",{value:l.id,key:l.name},g(l.name),9,gl))),128))],8,fl),[[x,A.value]])]),a("div",bl,[e[38]||(e[38]=a("label",{class:"form-label"},"Helm chart",-1)),e[39]||(e[39]=a("p",{class:"text-muted"},"Select the application",-1)),r(a("select",{class:"form-select","onUpdate:modelValue":e[12]||(e[12]=l=>S.value=l),onChange:J},[(o(!0),n(I,null,U(G.value,(l,h)=>{var P;return o(),n("option",{key:h,value:l.name}," ["+g(l.name)+"] "+g(((P=l.helmChart)==null?void 0:P.chartVersion)||"latest"),9,hl)}),128))],544),[[x,S.value]])]),c.value=="Application Installation"?(o(),n("div",yl,[e[47]||(e[47]=a("label",{class:"form-label"},"HPA Configuration",-1)),a("div",kl,[a("div",Cl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"hpaEnabled","onUpdate:modelValue":e[13]||(e[13]=l=>m.value.hpaEnabled=l)},null,512),[[le,m.value.hpaEnabled]]),e[40]||(e[40]=a("label",{class:"form-check-label",for:"hpaEnabled"}," Enable HPA (Horizontal Pod Autoscaler) ",-1))])]),m.value.hpaEnabled?(o(),n("div",Il,[a("div",null,[e[41]||(e[41]=a("label",{class:"form-label required"}," minReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"1","onUpdate:modelValue":e[14]||(e[14]=l=>m.value.hpaMinReplicas=l)},null,512),[[E,m.value.hpaMinReplicas]])]),a("div",null,[e[42]||(e[42]=a("label",{class:"form-label required"}," maxReplicas ",-1)),r(a("input",{type:"number",class:"form-control w-90-per",placeholder:"10","onUpdate:modelValue":e[15]||(e[15]=l=>m.value.hpaMaxReplicas=l)},null,512),[[E,m.value.hpaMaxReplicas]])]),a("div",null,[e[43]||(e[43]=a("label",{class:"form-check-label mb-2"}," CPU (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"60","onUpdate:modelValue":e[16]||(e[16]=l=>m.value.hpaCpuUtilization=l)},null,512),[[E,m.value.hpaCpuUtilization]]),e[44]||(e[44]=Y(" % "))]),a("div",null,[e[45]||(e[45]=a("label",{class:"form-check-label mb-2"}," MEMORY (%) ",-1)),r(a("input",{type:"number",class:"form-control w-80-per d-inline",placeholder:"80","onUpdate:modelValue":e[17]||(e[17]=l=>m.value.hpaMemoryUtilization=l)},null,512),[[E,m.value.hpaMemoryUtilization]]),e[46]||(e[46]=Y(" % "))])])):y("",!0)])):y("",!0),c.value=="Application Installation"?(o(),n("div",wl,[e[52]||(e[52]=a("label",{class:"form-label"},"Ingress Configuration",-1)),a("div",Sl,[a("div",xl,[r(a("input",{class:"form-check-input",type:"checkbox",id:"ingressEnabled","onUpdate:modelValue":e[18]||(e[18]=l=>f.value.ingressEnabled=l)},null,512),[[le,f.value.ingressEnabled]]),e[48]||(e[48]=a("label",{class:"form-check-label",for:"ingressEnabled"}," Enable Ingress ",-1))])]),f.value.ingressEnabled?(o(),n("div",Vl,[a("div",Ul,[e[49]||(e[49]=a("label",{class:"form-label"},"Host",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"example.com","onUpdate:modelValue":e[19]||(e[19]=l=>f.value.ingressHost=l)},null,512),[[E,f.value.ingressHost]])]),a("div",Ml,[e[50]||(e[50]=a("label",{class:"form-label"},"Path",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"/","onUpdate:modelValue":e[20]||(e[20]=l=>f.value.ingressPath=l)},null,512),[[E,f.value.ingressPath]])]),a("div",Al,[e[51]||(e[51]=a("label",{class:"form-label"},"Ingress Class",-1)),r(a("input",{type:"text",class:"form-control",placeholder:"nginx","onUpdate:modelValue":e[21]||(e[21]=l=>f.value.ingressClass=l),disabled:""},null,512),[[E,f.value.ingressClass]])])])):y("",!0)])):y("",!0)],64)):y("",!0)]),a("div",Nl,[a("a",{class:"btn btn-link link-secondary","data-bs-dismiss":"modal",onClick:z}," Cancel "),a("div",null,[c.value=="Application Installation"?(o(),n("button",{key:0,class:"btn btn-danger ms-auto me-1",onClick:pe,disabled:!N.value}," Spec Check ",8,El)):y("",!0),a("button",{class:"btn btn-primary ms-auto","data-bs-dismiss":"modal",onClick:de,disabled:N.value}," Deploy ",8,_l)])])])])]))}}),sa=ye(Ll,[["__scopeId","data-v-b2abd3fc"]]);export{sa as A,Dl as I,aa as a,Ol as b,Wl as c,jl as d,Fl as e,Xl as f,ta as g,Gl as h,Yl as i,Jl as j,Ql as k,Se as l,Kl as m,zl as n,Zl as o,ea as p,Bl as q,ae as r,la as s,ql as u};
